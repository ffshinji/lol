<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFLegendsHub | ≈ûampiyonlar</title>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="dashboard.html" class="logo">
                    <img src="https://i.hizliresim.com/h701fas.jpg" class="logo-icon" alt="FF">
                    <span class="logo-text">FFLegendsHub</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Ana Men√º</div>
                    <a href="index.html" class="nav-link"><span class="nav-emoji">üìä</span><span>√ñnizleme</span></a>
                    <a href="players.html" class="nav-link"><span class="nav-emoji">üë•</span><span>Oyuncular</span></a>
                    <a href="matches.html" class="nav-link"><span class="nav-emoji">üìú</span><span>Ge√ßmi≈ü
                            Ma√ßlar</span></a>
                    <a href="draft.html" class="nav-link"><span class="nav-emoji">‚öîÔ∏è</span><span>Draft Yap</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">ƒ∞statistikler</div>
                    <a href="leaderboard.html" class="nav-link"><span class="nav-emoji">üèÜ</span><span>Liderlik
                            Tablosu</span></a>
                    <a href="champions.html" class="nav-link active"><span
                            class="nav-emoji">‚≠ê</span><span>≈ûampiyonlar</span></a>
                    <a href="seasons.html" class="nav-link"><span class="nav-emoji">üìÖ</span><span>Sezonlar</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Sistem</div>
                    <a href="settings.html" class="nav-link"><span class="nav-emoji">‚öôÔ∏è</span><span>Ayarlar</span></a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">‚≠ê ≈ûampiyon ƒ∞statistikleri</h1>
                <p class="page-description">T√ºm ≈üampiyonlarƒ±n performans istatistikleri.</p>
            </div>

            <div class="grid grid-cols-3 mb-6" id="champ-stats-header"></div>

            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th style="color: #ff8c00;">≈ûampiyon</th>
                                <th class="text-center sortable" onclick="loadChampions('matches')"
                                    style="color: #ff8c00; cursor: pointer;">Oynanan <span id="sort-matches"></span>
                                </th>
                                <th class="text-center sortable" onclick="loadChampions('wl')"
                                    style="color: #ff8c00; cursor: pointer;">W/L <span id="sort-wl"></span></th>
                                <th class="text-center sortable" onclick="loadChampions('winRate')"
                                    style="color: #ff8c00; cursor: pointer;">Win Rate <span id="sort-winRate"></span>
                                </th>
                                <th class="text-center sortable" onclick="loadChampions('kda')"
                                    style="color: #ff8c00; cursor: pointer;">KDA <span id="sort-kda"></span></th>
                            </tr>
                        </thead>
                        <tbody id="champ-stats-tbody">
                            <tr>
                                <td colspan="4" class="empty-state">Veri yok.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/app.js"></script>
    <script>
        let currentSort = { field: 'winRate', direction: 'desc' };

        window.addEventListener('appReady', () => loadChampions());
        if (typeof App !== 'undefined' && App.isReady) loadChampions();

        function loadChampions(sortField = null) {
            // Update sort state
            if (sortField) {
                if (currentSort.field === sortField) {
                    currentSort.direction = currentSort.direction === 'desc' ? 'asc' : 'desc';
                } else {
                    currentSort.field = sortField;
                    currentSort.direction = 'desc';
                }
            }

            // Update Sort Icons
            ['matches', 'wl', 'winRate', 'kda'].forEach(f => {
                const el = document.getElementById(`sort-${f}`);
                if (el) el.textContent = '';
                if (f === currentSort.field) {
                    if (el) el.textContent = currentSort.direction === 'desc' ? '‚ñº' : '‚ñ≤';
                }
            });

            let champions = Stats.calculateChampionStats();

            // Apply Sort
            champions.sort((a, b) => {
                let valA, valB;
                switch (currentSort.field) {
                    case 'matches':
                        valA = a.matches; valB = b.matches; break;
                    case 'wl':
                        valA = a.wins - a.losses; valB = b.wins - b.losses; break; // Sort by Net Wins
                    case 'kda':
                        valA = parseFloat(a.kda); valB = parseFloat(b.kda); break;
                    case 'winRate':
                    default:
                        valA = a.winRate; valB = b.winRate; break;
                }

                return currentSort.direction === 'desc' ? valB - valA : valA - valB;
            });

            const headerContainer = document.getElementById('champ-stats-header');
            const tbody = document.getElementById('champ-stats-tbody');

            if (champions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">Hen√ºz ≈üampiyon verisi yok.</td></tr>';
                headerContainer.innerHTML = '';
                return;
            }

            // Calculations
            const validChamps = champions.filter(c => c.matches >= 1); // Consider all with at least 1 match

            const topPlayed = champions[0];
            const topWR = [...validChamps].sort((a, b) => b.winRate - a.winRate)[0];
            const bestKDA = [...validChamps].sort((a, b) => parseFloat(b.kda) - parseFloat(a.kda))[0];
            const worstWR = [...validChamps].sort((a, b) => a.winRate - b.winRate)[0];
            const worstKDA = [...validChamps].sort((a, b) => parseFloat(a.kda) - parseFloat(b.kda))[0];

            // Helpers for cards
            const renderCard = (title, icon, champ, value, customStyle) => {
                if (!champ) return `
                    <div class="stat-card">
                        <div class="stat-card-header"><span class="icon">${icon}</span> ${title}</div>
                        <div class="stat-card-content"><div class="text-muted">-</div></div>
                    </div>`;

                return `
                    <div class="stat-card">
                        <div class="stat-card-header"><span class="icon">${icon}</span> ${title}</div>
                        <div class="stat-card-content">
                            <img src="${Utils.getChampionIcon(champ.id)}" style="width:48px;height:48px;border-radius:8px;" onerror="this.src='${Utils.getProfileIcon(champ.id)}'">
                            <div class="stat-card-info">
                                <div class="stat-card-name">${champ.id}</div>
                                <div class="stat-card-value" style="${customStyle}">${value}</div>
                            </div>
                        </div>
                    </div>
                `;
            };

            // New Layout: 4 Top Cards, then Most Played + Total row
            headerContainer.className = 'flex flex-col gap-6 mb-6';
            headerContainer.innerHTML = `
                <!-- Top Stats Row -->
                <div class="grid grid-cols-4 gap-4">
                    ${renderCard('EN Y√úKSEK WR', 'üèÜ', topWR, topWR?.winRate + '%', Utils.getWinRateColor(topWR?.winRate))}
                    ${renderCard('EN ƒ∞Yƒ∞ KDA', '‚öîÔ∏è', bestKDA, bestKDA?.kda, Utils.getKDAColor(bestKDA?.kda))}
                    ${renderCard('EN K√ñT√ú WR', 'üíÄ', worstWR, worstWR?.winRate + '%', Utils.getWinRateColor(worstWR?.winRate))}
                    ${renderCard('EN K√ñT√ú KDA', 'üíî', worstKDA, worstKDA?.kda, Utils.getKDAColor(worstKDA?.kda))}
                </div>

                <!-- Secondary Row -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- Most Played -->
                    <div class="stat-card">
                        <div class="stat-card-header"><span class="icon">üî•</span> EN √áOK OYNANAN</div>
                        <div class="stat-card-content">
                            <img src="${Utils.getChampionIcon(topPlayed.id)}" style="width:48px;height:48px;border-radius:8px;" onerror="this.src='${Utils.getProfileIcon(topPlayed.id)}'">
                            <div class="stat-card-info">
                                <div class="stat-card-name">${topPlayed.id}</div>
                                <div class="stat-card-value" style="color: #fff;">${topPlayed.matches} ma√ß</div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Count (Resized) -->
                    <div class="stat-card">
                        <div class="stat-card-header"><span class="icon">üìä</span> TOPLAM OYNANAN ≈ûAMPƒ∞YON</div>
                         <div class="stat-card-content" style="justify-content: center; padding: 10px;">
                            <div class="stat-card-value" style="font-size:2.5rem; color: #fff;">${champions.length}</div>
                        </div>
                    </div>
                </div>
            `;

            tbody.innerHTML = champions.map(c => `
                <tr>
                    <td>
                        <div class="flex items-center gap-3">
                            <img src="${Utils.getChampionIcon(c.id)}" style="width:36px;height:36px;border-radius:6px;" onerror="this.src='${Utils.getProfileIcon(c.id)}'">
                            <span style="font-weight:var(--font-semibold)">${c.id}</span>
                        </div>
                    </td>
                    <td class="text-center">${c.matches}</td>
                    <td class="text-center"><span class="text-win">${c.wins}</span>/<span class="text-lose">${c.losses}</span></td>
                    <td class="text-center" style="${Utils.getWinRateColor(c.winRate)}; font-weight:bold">${c.winRate}%</td>
                    <td class="text-center" style="${Utils.getKDAColor(c.kda)}; font-weight:bold">${c.kda}</td>
                </tr>
            `).join('');
        }
    </script>
</body>

</html>